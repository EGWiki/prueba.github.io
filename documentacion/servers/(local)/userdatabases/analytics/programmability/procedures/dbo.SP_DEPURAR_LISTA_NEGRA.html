<!DOCTYPE HTML>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<title>dbo.SP_DEPURAR_LISTA_NEGRA</title>
<script src="../../../../../../scripts/jquery-1.12.0.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/bootstrap.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/clipboard.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/main.js" type="text/javascript"></script>
<link rel="stylesheet" href="../../../../../../styles/bootstrap/Default Dark.css" type="text/css">
<link rel="stylesheet" href="../../../../../../styles/main.css" type="text/css">
<link rel="stylesheet" href="../../../../../../styles/svg.css" type="text/css">
</head>
<body class="watermark">

  <div class="page-wrap">
    <div class="header">
      <div class="row">
        <div class="col-xs-12">
          <ol class="breadcrumb">
            <li><a href="../../../../../../startpage.html" data-mapping-enabled="true">Project</a></li>
            <li><a href="../../../../../../Servers\Servers.html" data-mapping-enabled="true">Servers</a></li>
            <li><a href="../../../../../../Servers\(LOCAL)\(LOCAL).html" data-mapping-enabled="true">(LOCAL)</a></li>
            <li><a href="../../../../../../Servers\(LOCAL)\UserDatabases\UserDatabases.html" data-mapping-enabled="true">User databases</a></li>
            <li><a href="../../../../../../Servers\(LOCAL)\UserDatabases\analytics\analytics.html" data-mapping-enabled="true">analytics</a></li>
            <li><a href="../../../../../../Servers\(LOCAL)\UserDatabases\analytics\Programmability\Programmability.html" data-mapping-enabled="true">Programmability</a></li>
            <li><a href="../../../../../../Servers\(LOCAL)\UserDatabases\analytics\Programmability\Procedures\Procedures.html" data-mapping-enabled="true">Stored Procedures</a></li>
            <li class="active">dbo.SP_DEPURAR_LISTA_NEGRA</li>
          </ol>
        </div>
      </div>
      <div class="row">
        <div class="title col-xs-12">
          <div><svg class="inline-middle image-large dark" data-toggle="tooltip" title="dbo.SP_DEPURAR_LISTA_NEGRA" data-original-title="dbo.SP_DEPURAR_LISTA_NEGRA">
            <svg viewBox="0 0 16 16"><path d="M15.997 15.998h-16v-16h16v16z" class="vs_output" /><path d="M7.464 10.664H3.197V9.598h4.267v1.066zm0-2.133H3.197V7.464h4.267v1.067zm5.333 4.267h-6.4V11.73h6.4v1.067zm-1.066-2.134h-3.2V9.598h3.2v1.066zm-6.4 2.134H3.197V11.73h2.134v1.067zm5.333-4.267H8.531V7.464h2.133v1.067zm-3.2-2.133H3.197V5.33h4.267v1.067zm6.4 7.466H2.131v-9.6h11.733v9.6zm-12.8 1.067h13.867V1.064H1.064v13.867z" class="vs_background" /><path d="M12.797 12.798h-6.4V11.73h6.4v1.067zm-7.466 0H3.197V11.73h2.134v1.067zm-2.134-3.2l4.267.02v1.046H3.197V9.598zm0-2.114l4.267-.02v1.067H3.197V7.484zm0-2.153h4.267v1.067H3.197V5.33zm5.334 4.267h3.2v1.066h-3.2V9.598zm0-2.134h2.133v1.067H8.531V7.464zm-6.4 6.4h11.733v-9.6H2.131v9.6z" class="vs_foreground" /></svg></svg><h1 class="inline-middle">dbo.SP_DEPURAR_LISTA_NEGRA</h1>
            <div class="dropdown actions-btn-wrap">
              <button type="button" class="btn btn-default actions-btn" data-toggle="dropdown"><span class="icon-actions icon-small actions-btn-span"></span></button>
              <ul class="dropdown-menu dropdown-menu-right">
                <li><a id="CollapseAll" href="#">Collapse All</a></li>
                <li><a id="ExpandAll" href="#">Expand All</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <div id="Description" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Description</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span></span>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Properties</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <table class="table table-hover table-bordered">
              <tbody>
                <tr>
                  <th>Name</th>
                  <th>Value</th>
                </tr>
                <tr>
                  <td>ANSI Nulls ON</td>
                  <td><p class="value-true">True</p></td>
                </tr>
                <tr>
                  <td>Quoted Identifier ON</td>
                  <td><p class="value-true">True</p></td>
                </tr>
                <tr>
                  <td>Encrypted</td>
                  <td><p class="value-false">False</p></td>
                </tr>
                <tr>
                  <td>Execute As</td>
                  <td></td>
                </tr>
                <tr>
                  <td>Assembly</td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="SqlScript" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">SQL Script</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <div class="zero-clipboard">
              <span class="btn-clipboard btn-default panel-default" data-clipboard-action="copy" data-clipboard-target=".sqlscript" data-toggle="tooltip" title="Copy to clipboard">Copy</span></div><div class="sqlscript  panel-default" style="word-wrap: break-word; padding-right:60px">
              <font color="#569cd6">SET</font>&nbsp;<font color="#569cd6">QUOTED_IDENTIFIER</font><font color="#b4b4b4">,</font>&nbsp;<font color="#569cd6">ANSI_NULLS</font>&nbsp;<font color="#569cd6">ON</font><br /><font color="#569cd6">GO</font><br /><font color="#569cd6">CREATE</font>&nbsp;<font color="#b4b4b4">OR</font>&nbsp;<font color="#569cd6">ALTER</font>&nbsp;<font color="#569cd6">PROCEDURE</font>&nbsp;<font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">SP_DEPURAR_LISTA_NEGRA</font><br /><font color="#569cd6">AS</font><br /><font color="#608b4e">--exec [SP_DEPURAR_ASIG_RIPLEY]</font><br /><font color="#608b4e">-- =======================================================================================================================================</font><br /><font color="#608b4e">-- Author:      Luigi Falcon</font><br /><font color="#608b4e">-- Create date: 2022-03-31</font><br /><font color="#608b4e">-- Database:    analytics</font><br /><font color="#608b4e">-- Description: separa los telefonos de la asignacion, los prioriza, separa los telefonos errados y normaliza.</font><br /><font color="#608b4e">-- =======================================================================================================================================</font><br /><font color="#608b4e">------------------------- corregimos los dni y agregamos fecha de proceso -------------------------</font><br /><font color="#dcdcdc"></font><br /><font color="#569cd6">IF</font>&nbsp;<font color="#ff00ff">OBJECT_ID</font><font color="#b4b4b4">(</font><font color="#d69d85">'tempdb..#correos'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">IS</font>&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">NULL</font>&nbsp;<font color="#569cd6">BEGIN</font>&nbsp;<font color="#569cd6">drop</font>&nbsp;<font color="#569cd6">table</font>&nbsp;<font color="#ffffff">#correos</font>&nbsp;<font color="#569cd6">END</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">select</font>&nbsp;<font color="#ffffff">[fec_pro]</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">format</font><font color="#b4b4b4">(</font><font color="#ff00ff">getdate</font><font color="#b4b4b4">(</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'yyyy-MM-dd'</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">a</font><font color="#b4b4b4">.</font><font color="#b4b4b4">*</font><br /><font color="#569cd6">INTO</font>&nbsp;<font color="#ffffff">#correos</font><br /><font color="#569cd6">from</font>&nbsp;<font color="#ffffff">analytics</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">tblp_listanegra</font>&nbsp;<font color="#ffffff">a</font>&nbsp;<font color="#569cd6">where</font>&nbsp;<font color="#ffffff">a</font><font color="#b4b4b4">.</font><font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%@%'</font><br /><font color="#dcdcdc"></font><br /><font color="#569cd6">IF</font>&nbsp;<font color="#ff00ff">OBJECT_ID</font><font color="#b4b4b4">(</font><font color="#d69d85">'tempdb..#tlf'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">IS</font>&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">NULL</font>&nbsp;<font color="#569cd6">BEGIN</font>&nbsp;<font color="#569cd6">drop</font>&nbsp;<font color="#569cd6">table</font>&nbsp;<font color="#ffffff">#tlf</font>&nbsp;<font color="#569cd6">END</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">select</font>&nbsp;<font color="#ffffff">[fec_pro]</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">format</font><font color="#b4b4b4">(</font><font color="#ff00ff">getdate</font><font color="#b4b4b4">(</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'yyyy-MM-dd'</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">a</font><font color="#b4b4b4">.</font><font color="#b4b4b4">*</font><br /><font color="#569cd6">INTO</font>&nbsp;<font color="#ffffff">#tlf</font><br /><font color="#569cd6">from</font>&nbsp;<font color="#ffffff">analytics</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">tblp_listanegra</font>&nbsp;<font color="#ffffff">a</font>&nbsp;<font color="#569cd6">where</font>&nbsp;<font color="#ffffff">a</font><font color="#b4b4b4">.</font><font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%@%'</font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">--SELECT * FROM analytics.dbo.tblp_listanegra</font><br /><font color="#608b4e">------------------------- correccion de telefonos nivel 1 -------------------------</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#b4b4b4">null</font>&nbsp;<font color="#569cd6">where</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#d69d85">''</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#d69d85">' '</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">concat</font><font color="#b4b4b4">(</font><font color="#d69d85">'9'</font><font color="#b4b4b4">,</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#b5cea8">8</font>&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#569cd6">left</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'9'</font><font color="#b4b4b4">)</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#b4b4b4">null</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%null%'</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#d69d85">','</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%,%'</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#d69d85">'.'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%.%'</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#d69d85">'('</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%(%'</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#d69d85">')'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#d69d85">'%)%'</font><font color="#b4b4b4">;</font><br /><font color="#dcdcdc"></font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font><font color="#b4b4b4">=</font><font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">9</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">></font><font color="#b5cea8">9</font>&nbsp;<br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font><font color="#b4b4b4">=</font><font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">8</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">WHERE</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#b5cea8">9</font>&nbsp;&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#569cd6">LEFT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'0'</font><br /><font color="#569cd6">update</font>&nbsp;<font color="#ffffff">#TLF</font>&nbsp;<font color="#569cd6">set</font>&nbsp;<font color="#ffffff">datos</font><font color="#b4b4b4">=</font>&nbsp;<font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><br /><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><br /><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><br /><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><font color="#ff00ff">replace</font><font color="#b4b4b4">(</font><br /><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'+'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'_'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'.'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">' '</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'-'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'/'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'\'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'#'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'|'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'a'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'b'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'c'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'d'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'e'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'f'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'g'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'h'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'i'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'j'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><br /><font color="#b4b4b4">,</font><font color="#d69d85">'k'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'l'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'m'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'n'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'o'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'p'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'q'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'r'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'s'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'t'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'u'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'v'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'w'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'x'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'y'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'z'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'A'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><br /><font color="#b4b4b4">,</font><font color="#d69d85">'B'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'C'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'D'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'E'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'F'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'G'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'H'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'I'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'J'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'K'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'L'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'M'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'N'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'O'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'P'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'Q'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'R'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><br /><font color="#b4b4b4">,</font><font color="#d69d85">'S'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'T'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'U'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'V'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'W'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'X'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'Y'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">,</font><font color="#d69d85">'Z'</font><font color="#b4b4b4">,</font><font color="#d69d85">''</font><font color="#b4b4b4">)</font><font color="#b4b4b4">;</font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">--select * from [analytics].dbo.Plantilla_Telefonos_Errados </font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">------------------------- eliminamos registros duplicados de los telefonos errados -------------------------</font><br /><font color="#b4b4b4">;</font><font color="#569cd6">with</font>&nbsp;<font color="#ffffff">DUPLICADO_TLF_ln</font>&nbsp;<font color="#569cd6">as</font><br /><font color="#b4b4b4">(</font><font color="#569cd6">select</font>&nbsp;<font color="#b4b4b4">*</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ff00ff">ROW_NUMBER</font><font color="#b4b4b4">(</font><font color="#b4b4b4">)</font><font color="#569cd6">OVER</font><font color="#b4b4b4">(</font><font color="#569cd6">PARTITION</font>&nbsp;<font color="#569cd6">BY</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#569cd6">ORDER</font>&nbsp;<font color="#569cd6">BY</font>&nbsp;<font color="#ffffff">fecha_reclamo</font>&nbsp;<font color="#569cd6">desc</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">as</font>&nbsp;<font color="#ffffff">fila</font>&nbsp;<font color="#569cd6">from</font>&nbsp;<font color="#ffffff">#tlf</font>&nbsp;<font color="#b4b4b4">)</font><br /><font color="#569cd6">delete</font>&nbsp;<font color="#569cd6">from</font>&nbsp;<font color="#ffffff">DUPLICADO_TLF_ln</font>&nbsp;<font color="#569cd6">where</font>&nbsp;<font color="#ffffff">fila</font>&nbsp;<font color="#b4b4b4">></font><font color="#b5cea8">1</font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">------------------------- NORMALIZAMOS LOS TELEFONOS -------------------------</font><br /><font color="#569cd6">IF</font>&nbsp;<font color="#ff00ff">OBJECT_ID</font><font color="#b4b4b4">(</font><font color="#d69d85">'tempdb..#tlf2'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">IS</font>&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">NULL</font>&nbsp;<font color="#569cd6">BEGIN</font>&nbsp;<font color="#569cd6">drop</font>&nbsp;<font color="#569cd6">table</font>&nbsp;<font color="#ffffff">#tlf2</font>&nbsp;<font color="#569cd6">END</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">select</font>&nbsp;<font color="#ffffff">fec_pro</font>&nbsp;<br /><font color="#b4b4b4">,</font><font color="#ffffff">telefono</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'9'</font>&nbsp;<font color="#b4b4b4">AND</font>&nbsp;<font color="#569cd6">LEFT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'9'</font>&nbsp;&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#569cd6">else</font>&nbsp;<br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'9'</font>&nbsp;<font color="#b4b4b4">AND</font>&nbsp;<font color="#569cd6">LEFT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">2</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'01'</font><font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">4</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">7</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'9'</font>&nbsp;<font color="#b4b4b4">AND</font>&nbsp;<font color="#569cd6">LEFT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'0'</font><font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">2</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">8</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'9'</font>&nbsp;<font color="#b4b4b4">AND</font>&nbsp;<font color="#569cd6">LEFT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'9'</font><font color="#b4b4b4">)</font><font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">4</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">8</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'9'</font>&nbsp;<font color="#b4b4b4">AND</font>&nbsp;<font color="#569cd6">LEFT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'9'</font><font color="#b4b4b4">)</font><font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">3</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">7</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#d69d85">'8'</font>&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">2</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#569cd6">left</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'1'</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">7</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#d69d85">'8'</font>&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">2</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#569cd6">left</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'0'</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#569cd6">RIGHT</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">7</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#d69d85">'8'</font>&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#569cd6">left</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">2</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">IN</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'41'</font><font color="#b4b4b4">,</font><font color="#d69d85">'42'</font><font color="#b4b4b4">,</font><font color="#d69d85">'43'</font><font color="#b4b4b4">,</font><font color="#d69d85">'44'</font><font color="#b4b4b4">,</font><font color="#d69d85">'51'</font><font color="#b4b4b4">,</font><font color="#d69d85">'52'</font><font color="#b4b4b4">,</font><font color="#d69d85">'53'</font><font color="#b4b4b4">,</font><font color="#d69d85">'54'</font><font color="#b4b4b4">,</font><font color="#d69d85">'56'</font><font color="#b4b4b4">,</font><font color="#d69d85">'61'</font><font color="#b4b4b4">,</font><font color="#d69d85">'62'</font><font color="#b4b4b4">,</font><font color="#d69d85">'63'</font><font color="#b4b4b4">,</font><font color="#d69d85">'64'</font><font color="#b4b4b4">,</font><font color="#d69d85">'64'</font><font color="#b4b4b4">,</font><font color="#d69d85">'65'</font><font color="#b4b4b4">,</font><font color="#d69d85">'66'</font><font color="#b4b4b4">,</font><font color="#d69d85">'67'</font><font color="#b4b4b4">,</font><br />&nbsp;<font color="#d69d85">'72'</font><font color="#b4b4b4">,</font><font color="#d69d85">'73'</font><font color="#b4b4b4">,</font><font color="#d69d85">'74'</font><font color="#b4b4b4">,</font><font color="#d69d85">'76'</font><font color="#b4b4b4">,</font><font color="#d69d85">'82'</font><font color="#b4b4b4">,</font><font color="#d69d85">'83'</font><font color="#b4b4b4">,</font><font color="#d69d85">'84'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#ff00ff">SUBSTRING</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">3</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">LIKE</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;<font color="#569cd6">else</font><br />&nbsp;<font color="#569cd6">case</font>&nbsp;<font color="#569cd6">when</font>&nbsp;<font color="#ff00ff">LEN</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">)</font><font color="#b4b4b4">=</font><font color="#d69d85">'7'</font>&nbsp;<font color="#b4b4b4">and</font>&nbsp;<font color="#569cd6">left</font><font color="#b4b4b4">(</font><font color="#ffffff">datos</font><font color="#b4b4b4">,</font><font color="#b5cea8">1</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">like</font>&nbsp;<font color="#b4b4b4">(</font><font color="#d69d85">'%[2-8]%'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#569cd6">then</font>&nbsp;<font color="#ffffff">datos</font>&nbsp;&nbsp;<font color="#569cd6">else</font>&nbsp;<font color="#ffffff">datos</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font>&nbsp;<font color="#569cd6">end</font><br /><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">numeros_correos</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">dni_reclamante</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">fecha_reclamo</font><br /><font color="#dcdcdc"></font><br /><font color="#569cd6">into</font>&nbsp;<font color="#ffffff">#tlf2</font><br /><font color="#569cd6">from</font>&nbsp;<font color="#ffffff">#tlf</font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">------------------------- GUARDAMOS LOS TLF DE LA LISTA NEGRA -------------------------</font><br /><font color="#569cd6">IF</font>&nbsp;<font color="#ff00ff">OBJECT_ID</font><font color="#b4b4b4">(</font><font color="#d69d85">'[analytics].dbo.ripley_Lista_negra'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">IS</font>&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">NULL</font>&nbsp;<font color="#569cd6">BEGIN</font>&nbsp;<font color="#569cd6">drop</font>&nbsp;<font color="#569cd6">table</font>&nbsp;<font color="#ffffff">[analytics]</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">ripley_Lista_negra</font>&nbsp;<font color="#569cd6">END</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">select</font>&nbsp;<font color="#b4b4b4">*</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">idcartera</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#b5cea8">1</font>&nbsp;<font color="#569cd6">into</font>&nbsp;<font color="#ffffff">[analytics]</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">ripley_Lista_negra</font>&nbsp;<font color="#569cd6">from</font>&nbsp;<font color="#ffffff">#tlf2</font>&nbsp;<br /><font color="#dcdcdc"></font><br /><font color="#569cd6">drop</font>&nbsp;<font color="#569cd6">table</font>&nbsp;<font color="#ffffff">#tlf2</font><font color="#b4b4b4">;</font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">------------------------- GUARDAMOS LOS CORREOS DE LA LISTA NEGRA -------------------------</font><br /><font color="#569cd6">IF</font>&nbsp;<font color="#ff00ff">OBJECT_ID</font><font color="#b4b4b4">(</font><font color="#d69d85">'[analytics].dbo.ripley_Lista_negra_correos'</font><font color="#b4b4b4">)</font>&nbsp;<font color="#b4b4b4">IS</font>&nbsp;<font color="#b4b4b4">not</font>&nbsp;<font color="#b4b4b4">NULL</font>&nbsp;<font color="#569cd6">BEGIN</font>&nbsp;<font color="#569cd6">drop</font>&nbsp;<font color="#569cd6">table</font>&nbsp;<font color="#ffffff">[analytics]</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">ripley_Lista_negra_correos</font>&nbsp;<font color="#569cd6">END</font><font color="#b4b4b4">;</font><br /><font color="#569cd6">select</font>&nbsp;<font color="#b4b4b4">*</font><font color="#b4b4b4">,</font>&nbsp;<font color="#ffffff">idcartera</font>&nbsp;<font color="#b4b4b4">=</font>&nbsp;<font color="#b5cea8">1</font>&nbsp;<font color="#569cd6">into</font>&nbsp;<font color="#ffffff">[analytics]</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">ripley_Lista_negra_correos</font>&nbsp;<font color="#569cd6">from</font>&nbsp;<font color="#ffffff">#correos</font><br /><font color="#dcdcdc"></font><br /><font color="#569cd6">TRUNCATE</font>&nbsp;<font color="#569cd6">TABLE</font>&nbsp;<font color="#ffffff">analytics</font><font color="#b4b4b4">.</font><font color="#ffffff">dbo</font><font color="#b4b4b4">.</font><font color="#ffffff">tblp_listanegra</font><font color="#b4b4b4">;</font><br /><font color="#608b4e">/*
select * from [analytics].dbo.ripley_Lista_negra_correos
select * from [analytics].dbo.ripley_Lista_negra
*/</font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">/*
truncate table ASIGNACIONES.DBO.MASTER_ASIGNACION_RIPLEY
truncate table [analytics].dbo.Master_telefonos
truncate table [analytics].dbo.Plantilla_Telefonos_Errados
*/</font><br /><font color="#dcdcdc"></font><br /><font color="#dcdcdc"></font><br /><font color="#608b4e">/*
idfuente
asignacion cliente t1 1
asignacion cliente t2 1
asignacion cliente t3 1
busqueda search 2
busqueda x 3
etc

---------------------------
|  CARTERA	 |	IDCARTERA |
|-------------------------|
|   RIPLEY	 |	    1     |
---------------------------

*/</font><br /><font color="#dcdcdc"></font><br /><font color="#569cd6">GO</font></div>
          </div>
        </div>
      </div>
      <div id="DependsOn" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Depends On</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span class="text-muted">No items found</span>
          </div>
        </div>
      </div>
      <div id="UsedBy" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Used By</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span class="text-muted">No items found</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="col-xs-4">Author:&nbsp;</div>
    <div class="col-xs-4 align-center">Copyright &#169; All Rights Reserved</div>
    <div class="col-xs-4 align-right">Created:&nbsp;03/04/2022</div>
  </div>
</body>
</html>